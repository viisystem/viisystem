!function($){$.fn.focusEnd=function(){if($("body").hasClass("is-desktop")){this.focus();var a=this.val();return this.val("").val(a),this}},"undefined"==typeof window.jurakit&&(window.jurakit={}),jurakit.form={modalId:"modalId",modalInstance:null,modalMessage:null,loader:'<div class="loader">Loading...</div>',reset:function(a){if(0!==a.indexOf("#")&&(a="#"+a),$(a).find(":input").each(function(){switch(this.type){case"password":case"select-multiple":case"select-one":case"text":case"textarea":$(this).val(null);break;case"checkbox":case"radio":this.checked=!1}}),$(a).find("select").each(function(){$(this).val(null).trigger("change")}),"undefined"!=typeof tinyMCE&&null!==tinyMCE.activeEditor)try{tinyMCE.activeEditor.setContent("")}catch(t){}},ajax:function(){$(".form-ajax").off("beforeSubmit").on("beforeSubmit",function(a){return obj=$(this),obj.find(".has-error").length?!1:(params={eidTarget:"#"+obj.data("form-target"),eidPjaxContainer:"#"+obj.data("pjax-container"),eidAjaxContainer:"#"+obj.data("ajax-container"),funInitial:obj.data("func-initial"),funSuccess:obj.data("func-success")},void jurakit.form.panelSubmit(obj,params))}).on("submit",function(a){a.preventDefault()})},iframe:function(a){paramClass="modal-dialog-md",paramWidth=a.attr("data-modal-width"),"undefined"!=typeof paramWidth&&$(window).width()<1100&&(paramClass="modal-dialog-sm",paramWidth="auto"),paramHeight=a.attr("data-modal-height"),"undefined"==typeof paramHeight&&(paramHeight=$(window).height()-185),paramUrl=a.attr("data-url"),"undefined"==typeof paramUrl&&(paramUrl=a.attr("href")),paramPjax=a.data("pjax-container"),"undefined"!=typeof paramPjax&&(paramPjax="_pjax="+encodeURIComponent("#"+paramPjax));var t=[],e=a.attr("data-modal-button");"undefined"==typeof e&&e!==!1?t=[{label:$.t("Cancel"),cssClass:"btn btn-default",action:function(a){a.close()}},{label:$.t("Save"),cssClass:"btn btn-primary",action:function(a){$(".modal-iframe-body").contents().find(".notice-ajax-form-submit").show(),$(".modal-iframe-body").contents().find("form").submit()}}]:paramHeight+=60,paramSep=-1===paramUrl.indexOf("?")?"?":"&",jurakit.form.modalInstance=new BootstrapDialog({type:BootstrapDialog.TYPE_DEFAULT,id:a.data("source")+"Modal",title:"undefined"!=typeof a.data("title")?a.data("title"):" ",size:a.data("size")?a.data("size"):"size-wide",message:'<iframe class="modal-iframe-body" style="width:100%; height:'+paramHeight+'px" src="'+paramUrl+paramSep+paramPjax+'" frameborder="0"></iframe>',cssClass:"modal-iframe "+a.data("class"),buttons:t,tabindex:null,closeByBackdrop:!1,closeByKeyboard:!1,onshown:function(a){"auto"!=paramWidth&&$(".modal-dialog").css({width:paramWidth})}}).open()},iframeSuccess:function(a){0!==$(a).length&&jurakit.form.pjaxReload(a),jurakit.form.modalInstance.close()},event:function(){$('button[type="reset"]').on("click",function(a){a.preventDefault();var t=$(this).parents("form").attr("id");jurakit.form.reset(t),$("#"+t).find(".form-reset").val(1)})},filter:function(){$(".form-filter").off("beforeSubmit").on("beforeSubmit",function(a){return obj=$(this),obj.find(".has-error").length?!1:(params={eidTarget:"#"+obj.data("form-target"),eidPjaxContainer:"#"+obj.data("pjax-container"),eidAjaxContainer:"#"+obj.data("ajax-container"),funInitial:obj.data("func-initial"),funSuccess:obj.data("func-success")},void jurakit.form.filterSubmit(obj,params))}).on("submit",function(a){a.preventDefault()}),$(".form-filter").on("reset",function(a){a.preventDefault();var t=$(this).attr("id");jurakit.form.reset(t),$("#"+t).find(".form-reset").val(1),$("#"+t).submit()})},filterSubmit:function(a,t){return a.find(".has-error").length?!1:void $.ajax({url:a.attr("action"),type:"post",data:a.serialize(),success:function(a){jurakit.form.pjaxReload(t.eidPjaxContainer)}})},modal:function(a){params={eidPjaxContainer:"#"+a.data("pjax-container"),eidAjaxContainer:"#"+a.data("ajax-container"),liveSource:a.data("live-source"),funSuccess:a.data("func-success")},jurakit.form.modalMessage=$("<div></div>"),jurakit.form.modalInstance=new BootstrapDialog({type:BootstrapDialog.TYPE_DEFAULT,id:a.data("source")+"Modal",title:"undefined"!=typeof a.data("title")?a.data("title"):" ",size:a.data("size")?a.data("size"):"size-wide",cssClass:a.data("class"),message:jurakit.form.loader,tabindex:null,closeByBackdrop:!1,closeByKeyboard:!1,onhidden:function(a){jurakit.form.modalResetForm()}}).open(),url=a.attr("data-url"),"undefined"==typeof url&&(url=a.attr("href")),$.ajax({url:url,type:"get",dataType:"json",cache:!1,beforeSend:function(){jurakit.form.modalResetForm()},success:function(a){1===a.s&&a.hasOwnProperty("f")?(jurakit.form.modalMsg(a.f),jurakit.form.modalEvent(params)):0===a.s&&a.hasOwnProperty("m")?(jurakit.form.modalInstance.setType(BootstrapDialog.TYPE_DANGER),jurakit.form.modalInstance.setSize(BootstrapDialog.SIZE_NORMAL),jurakit.form.modalInstance.setTitle($.t("WARNING")),jurakit.form.modalInstance.getModal().removeClass("modal-full"),jurakit.form.modalInstance.getModal().removeClass("modal-auto"),jurakit.form.modalMsg(a.m)):jurakit.form.modalInstance.close()},error:function(a){jurakit.form.modalInstance.close()}})},modalMsg:function(a){jurakit.form.modalInstance.setMessage(jurakit.form.modalMessage.empty().append(a))},modalEvent:function(a){var t=$("#"+jurakit.form.modalInstance.getId()+" form .focus");t.length>0?t.first().focusEnd():$("#"+jurakit.form.modalInstance.getId()+" form input:text").first().focusEnd(),$("#"+jurakit.form.modalInstance.getId()+" form").on("beforeSubmit",function(t){jurakit.form.modalSubmit($(this),a)}).on("submit",function(a){a.preventDefault()})},modalSubmit:function(a,t){return a.find(".has-error").length?!1:void $.ajax({url:a.attr("action"),type:"post",data:a.serialize(),dataType:"json",success:function(a){jurakit.form.submitSuccess("modalSubmit",a,t)},error:function(a){jurakit.form.modalInstance.close()}})},modalResetForm:function(){eidTinymce=$("#"+jurakit.form.modalInstance.getId()+" .form-tinymce"),eidTinymce.length>0&&eidTinymce.each(function(a,t){try{tinyMCE.remove("#"+$(this).attr("id"))}catch(e){}})},modalOrder:function(a){var t=0;$(".modal.in").each(function(a){var e=$(this);t++,e.addClass("modal-level-"+t),e.prev(".modal-backdrop.in").addClass("modal-backdrop-level-"+t)}),$("body").attr("data-modal-level",t)},panel:function(obj){return params={eidTarget:"#"+obj.data("form-target"),eidPjaxContainer:"#"+obj.data("pjax-container"),eidAjaxContainer:"#"+obj.data("ajax-container"),funInitial:obj.data("func-initial"),funSuccess:obj.data("func-success")},"true"===obj.attr("aria-expanded")?!1:void $.ajax({url:obj.attr("data-url"),type:"post",data:obj.serialize(),dataType:"json",cache:!1,beforeSend:function(){jurakit.form.panelResetForm(params),null!=params.funInitial&&eval(params.funInitial+"(params)"),$(params.eidTarget).empty().html(jurakit.form.loader)},success:function(a){1===a.s&&a.hasOwnProperty("f")&&($(params.eidTarget).html(a.f),jurakit.form.panelEvent(params)),null!=params.eidAjaxContainer&&$(params.eidAjaxContainer).length>0&&a.hasOwnProperty("c")&&$(params.eidAjaxContainer).html(a.c),params.eidTarget.length>0&&null==jurakit.form.modalInstance&&$("html, body").animate({scrollTop:$(params.eidTarget).offset().top-55},1e3)}})},panelEvent:function(a){$(a.eidTarget+" form .focus").length>0?$(a.eidTarget+" form .focus").first().focusEnd():$(a.eidTarget+" form input:text").first().focusEnd(),$(a.eidTarget+" form").on("beforeSubmit",function(t){jurakit.form.panelSubmit($(this),a)}).on("submit",function(a){a.preventDefault()})},panelSubmit:function(a,t){return a.find(".has-error").length?!1:void $.ajax({url:a.attr("action"),type:"post",data:a.serialize(),dataType:"json",beforeSend:function(){$(t.eidTarget+' button[type="submit"]').attr("disabled","disabled")},success:function(a){jurakit.form.submitSuccess("panelSubmit",a,t)}})},panelResetForm:function(a){eidTinymce=$(a.eidTarget+" .form-tinymce"),eidTinymce.length>0&&eidTinymce.each(function(a,t){try{tinyMCE.remove("#"+$(this).attr("id"))}catch(e){}})},submitSuccess:function(type,data,params){return data.hasOwnProperty("r")?"reload"===data.r?(location.reload(),!1):(location.replace(data.r),!1):data.hasOwnProperty("m")?(jurakit.form.modalMsg(data.m),jurakit.form.modalInstance.setType(1==data.s?BootstrapDialog.TYPE_SUCCESS:BootstrapDialog.TYPE_DANGER),!1):data.hasOwnProperty("f")&&"ajaxSubmit"===type?($(params.eidTarget).html(data.f),jurakit.form.ajaxEvent(params),!1):data.hasOwnProperty("f")&&"modalSubmit"===type?(jurakit.form.modalMsg(data.f),jurakit.form.modalEvent(params),$(".form-group > span.select2").next(".select2").remove(),!1):(data.hasOwnProperty("f")&&"panelSubmit"===type&&(null!=params.funInitial&&eval(params.funInitial+"(params)"),$(params.eidTarget).html(data.f),jurakit.form.panelEvent(params)),data.hasOwnProperty("c")&&"panelSubmit"===type&&(jurakit.form.panelResetForm(params),$(params.eidTarget).empty(),"#undefined"!=params.eidAjaxContainer&&$(params.eidTarget).html(jurakit.form.loader)),null!=params.eidPjaxContainer&&$(params.eidPjaxContainer).length>0&&jurakit.form.pjaxReload(params.eidPjaxContainer),null!=params.eidAjaxContainer&&$(params.eidAjaxContainer).length>0&&data.hasOwnProperty("c")&&$(params.eidAjaxContainer).html(data.c),null!=params.funSuccess&&(params.funSuccess.indexOf("(")>=0?eval(params.funSuccess):eval(params.funSuccess+"(params, data)")),"modalSubmit"===type&&jurakit.form.modalInstance.close(),void("undefined"!=typeof params.liveSource&&$('[data-live-target="'+params.liveSource+'"]').each(function(a,t){$.ajax({url:$(this).data("live-url"),dataType:"json",success:function(a){$(this).html(a.count)}})})))},button:function(){if($(".form-btn-action").length>0){var a=65,t=function(){var t=$(window).scrollTop();t>a?$(".form-btn-action").addClass("fixed"):$(".form-btn-action").removeClass("fixed")};t(),$(window).scroll(function(){t()})}},"delete":function(a){BootstrapDialog.confirm({title:$.t("WARNING"),message:$.t("Are you sure you want to delete?"),type:BootstrapDialog.TYPE_DEFAULT,btnCancelLabel:$.t("Cancel"),btnOKLabel:$.t("Delete"),btnOKClass:"btn-danger",closeByBackdrop:!1,closeByKeyboard:!1,callback:function(t){if(t){var e=a.attr("data-url");"undefined"==typeof e&&(e=a.attr("href")),$.ajax({url:e,type:"POST",dataType:"json",success:function(t){return 0===t.s&&t.hasOwnProperty("m")?(BootstrapDialog.show({type:BootstrapDialog.TYPE_DANGER,message:t.m,buttons:[{label:$.t("Close"),action:function(a){a.close()}}]}),!1):void($(a.data("target-delete")).length>0&&$(a.data("target-delete")).fadeOut(300,function(){$(this).remove()}))}})}}})},pjaxReload:function(a,t){return 0==$(a).length?!1:(paramsPjax={container:a,timeout:!1,async:!1},paramsData=$(a).data("pjax-params"),"undefined"!=typeof paramsData&&$.extend(paramsPjax,paramsData),"undefined"!=typeof t&&$.extend(paramsPjax,t),$.pjax.reload(paramsPjax),!0)},toggle:function(){$('[data-toggle="collapse"]').on("click",function(a){a.preventDefault();var t=$(this).attr("href");$.ajax({url:app.urlToggle,type:"POST",dataType:"json",data:{target:t,status:$(t).hasClass("in")?0:1},success:function(a){}})})}}}(jQuery),$(window).resize(jurakit.form.button),$(document).ready(function(){jurakit.form.button(),jurakit.form.ajax(),jurakit.form.event(),jurakit.form.filter(),jurakit.form.toggle()}),$(document).on("pjax:success",function(a,t,e,o,r){jurakit.form.event(),jurakit.form.filter(),jurakit.form.toggle()}),$(window).keypress(function(a){if((115!=a.which||!a.ctrlKey)&&19!=a.which)return!0;var t=$(":focus").closest("form");return t.length>0&&t.submit(),a.preventDefault(),!1}),$(document).on("show.bs.modal",".modal",function(){}).on("shown.bs.modal",".modal.in",function(){jurakit.form.modalOrder()}).on("hidden.bs.modal",".modal",function(){jurakit.form.modalOrder()});